<UserControl x:Class="OOP_Semester.Views.SettingView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:OOP_Semester.ViewModels"
             mc:Ignorable="d"
             FontFamily="Segoe UI"
             Background="#fcfaf8">

    <UserControl.Resources>
        <SolidColorBrush x:Key="Primary" Color="#f48c25"/>
        <SolidColorBrush x:Key="PrimaryHover" Color="#d67a1f"/>
        <SolidColorBrush x:Key="Surface" Color="#ffffff"/>
        <SolidColorBrush x:Key="Border" Color="#e8dbce"/>
        <SolidColorBrush x:Key="TextMain" Color="#1c140d"/>
        <SolidColorBrush x:Key="TextSecondary" Color="#9c7349"/>
        <SolidColorBrush x:Key="HeaderBg" Color="#FFF7ED"/>
        <SolidColorBrush x:Key="HeaderBgHover" Color="#FFEDD5"/>
        <SolidColorBrush x:Key="IconBg" Color="#1AF48C25"/>

        <Style x:Key="LabelText" TargetType="TextBlock">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Foreground" Value="{StaticResource TextMain}"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
        </Style>
        <Style x:Key="HintText" TargetType="TextBlock">
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Foreground" Value="{StaticResource TextSecondary}"/>
        </Style>
        <Style x:Key="SectionTitleText" TargetType="TextBlock">
            <Setter Property="FontSize" Value="18"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="{StaticResource TextMain}"/>
        </Style>
        <Style x:Key="CardStyle" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource Surface}"/>
            <Setter Property="BorderBrush" Value="{StaticResource Border}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="20"/>
            <Setter Property="Padding" Value="24"/>
            <Setter Property="Margin" Value="0,0,0,16"/>
        </Style>

        <Style x:Key="ModernInput" TargetType="Control">
            <Setter Property="FontSize" Value="15"/>
            <Setter Property="Padding" Value="15,12"/>
            <Setter Property="Background" Value="#fcfaf8"/>
            <Setter Property="BorderBrush" Value="{StaticResource Border}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Control">
                        <Border CornerRadius="12" Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}">
                            <ScrollViewer x:Name="PART_ContentHost" Margin="0" Padding="{TemplateBinding Padding}"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="PrimaryButton" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource Primary}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="FontSize" Value="15"/>
            <Setter Property="Padding" Value="22,12"/>
            <Setter Property="MinHeight" Value="46"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border CornerRadius="12" Background="{TemplateBinding Background}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{StaticResource PrimaryHover}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Opacity" Value="0.9"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="SecondaryButton" TargetType="Button">
            <Setter Property="Background" Value="#fcfaf8"/>
            <Setter Property="Foreground" Value="{StaticResource TextMain}"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="FontSize" Value="15"/>
            <Setter Property="Padding" Value="16,10"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="BorderBrush" Value="{StaticResource Border}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border CornerRadius="12" Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="1">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#fff7ed"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="SectionExpander" TargetType="Expander">
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Expander">
                        <Border Background="{StaticResource Surface}" BorderBrush="{StaticResource Border}" BorderThickness="1" CornerRadius="20" Margin="0,0,0,16">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Border x:Name="HeaderBgBorder" Grid.Row="0" Background="{StaticResource HeaderBg}" CornerRadius="20" Padding="0">
                                    <ToggleButton x:Name="HeaderToggle" Background="Transparent" BorderThickness="0" Padding="24" HorizontalContentAlignment="Stretch"
                                                  IsChecked="{Binding IsExpanded, RelativeSource={RelativeSource TemplatedParent}, Mode=TwoWay}">
                                        <ToggleButton.Template>
                                            <ControlTemplate TargetType="ToggleButton">
                                                <ContentPresenter/>
                                            </ControlTemplate>
                                        </ToggleButton.Template>
                                        <ContentPresenter ContentSource="Header"/>
                                    </ToggleButton>
                                </Border>
                                <Border Grid.Row="1" x:Name="ContentHost" BorderBrush="{StaticResource Border}" BorderThickness="0,1,0,0" Padding="24,18,24,24" Visibility="Collapsed">
                                    <ContentPresenter ContentSource="Content"/>
                                </Border>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger SourceName="HeaderToggle" Property="IsMouseOver" Value="True">
                                <Setter TargetName="HeaderBgBorder" Property="Background" Value="{StaticResource HeaderBgHover}"/>
                            </Trigger>
                            <Trigger Property="IsExpanded" Value="True">
                                <Setter TargetName="ContentHost" Property="Visibility" Value="Visible"/>
                                <Setter TargetName="HeaderBgBorder" Property="CornerRadius" Value="20,20,0,0"/>
                            </Trigger>
                            <Trigger Property="IsExpanded" Value="False">
                                <Setter TargetName="HeaderBgBorder" Property="CornerRadius" Value="20"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="SwitchStyle" TargetType="ToggleButton">
            <Setter Property="Width" Value="50"/>
            <Setter Property="Height" Value="28"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ToggleButton">
                        <Grid>
                            <Border x:Name="Track" CornerRadius="999" Background="#e5e7eb"/>
                            <Ellipse x:Name="Thumb" Width="22" Height="22" Fill="White" Margin="3" HorizontalAlignment="Left"/>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="Track" Property="Background" Value="{StaticResource Primary}"/>
                                <Setter TargetName="Thumb" Property="HorizontalAlignment" Value="Right"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="StarRadio" TargetType="RadioButton">
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontSize" Value="34"/>
            <Setter Property="Foreground" Value="#d1d5db"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RadioButton">
                        <TextBlock Text="★" FontSize="{TemplateBinding FontSize}" Foreground="{TemplateBinding Foreground}" VerticalAlignment="Center" Margin="3,0"/>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter Property="Foreground" Value="#eab308"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Opacity" Value="0.9"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <Grid>
        <ScrollViewer VerticalScrollBarVisibility="Auto">
            <StackPanel Margin="40,30,40,40">

                <StackPanel Margin="0,0,0,28">
                    <TextBlock Text="Cài đặt" FontSize="36" FontWeight="Black" Foreground="{StaticResource TextMain}"/>
                    <TextBlock Text="Quản lý tài khoản và tùy chỉnh trải nghiệm." FontSize="16" Foreground="{StaticResource TextSecondary}" Margin="0,8,0,0"/>
                </StackPanel>

                <Expander Style="{StaticResource SectionExpander}" IsExpanded="True">
                    <Expander.Header>
                        <StackPanel Orientation="Horizontal">
                            <Border Width="40" Height="40" CornerRadius="12" Background="{StaticResource IconBg}" Margin="0,0,16,0">
                                <TextBlock Text="👤" FontSize="18" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                            </Border>
                            <TextBlock Text="Thông tin cá nhân" Style="{StaticResource SectionTitleText}" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Expander.Header>

                    <StackPanel>
                        <Grid Margin="0,0,0,20">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <Grid Width="80" Height="80">
                                <Border CornerRadius="40" BorderBrush="{StaticResource Border}" BorderThickness="2">
                                    <Border.Background>
                                        <ImageBrush ImageSource="{Binding AvatarSource}" Stretch="UniformToFill"/>
                                    </Border.Background>
                                </Border>
                            </Grid>

                            <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="24,0,0,0">
                                <TextBlock Text="Ảnh đại diện" Style="{StaticResource LabelText}" Margin="0,0,0,4"/>
                                <StackPanel Orientation="Horizontal" Margin="0,12,0,0">
                                    <Button Content="Chọn ảnh" Command="{Binding ChooseAvatarCommand}" Style="{StaticResource SecondaryButton}" Margin="0,0,12,0" Height="30" Width="84"/>
                                    <Button Content="Xóa ảnh" Command="{Binding RemoveAvatarCommand}" Style="{StaticResource SecondaryButton}" Height="32" Width="78" />
                                </StackPanel>
                            </StackPanel>
                        </Grid>

                        <StackPanel Margin="0,0,0,20">
                            <TextBlock Text="Tên hiển thị" Style="{StaticResource LabelText}" Margin="0,0,0,8"/>
                            <TextBox Style="{StaticResource ModernInput}" Text="{Binding DisplayName, UpdateSourceTrigger=PropertyChanged}" HorizontalAlignment="Stretch"/>

                            <TextBlock Text="Tài khoản" Style="{StaticResource LabelText}" Margin="0,12,0,8"/>
                            <TextBox Style="{StaticResource ModernInput}" Text="{Binding Account, Mode=OneWay}" IsReadOnly="True" HorizontalAlignment="Stretch" Foreground="#777"/>
                        </StackPanel>

                        <Border BorderBrush="{StaticResource Border}" BorderThickness="0,1,0,0" Padding="0,20,0,0" Margin="0,0,0,20">
                            <StackPanel>
                                <TextBlock Text="Đổi mật khẩu" FontWeight="Bold" FontSize="16" Foreground="{StaticResource TextMain}" Margin="0,0,0,12"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="20"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel Grid.Column="0">
                                        <TextBlock Text="Mật khẩu hiện tại" Style="{StaticResource HintText}" Margin="0,0,0,6"/>
                                        <PasswordBox x:Name="pbOldPass" Style="{StaticResource ModernInput}" PasswordChanged="PasswordBox_PasswordChanged"/>
                                    </StackPanel>
                                    <StackPanel Grid.Column="2">
                                        <TextBlock Text="Mật khẩu mới" Style="{StaticResource HintText}" Margin="0,0,0,6"/>
                                        <PasswordBox x:Name="pbNewPass" Style="{StaticResource ModernInput}" PasswordChanged="PasswordBox_PasswordChanged"/>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <StackPanel Orientation="Horizontal" Margin="0,20,0,0">
                            <Button Content="Lưu thông tin" Command="{Binding SaveCommand}" Style="{StaticResource PrimaryButton}" Width="161"/>
                        </StackPanel>
                    </StackPanel>
                </Expander>

                <Expander Style="{StaticResource SectionExpander}">
                    <Expander.Header>
                        <StackPanel Orientation="Horizontal">
                            <Border Width="40" Height="40" CornerRadius="12" Background="{StaticResource IconBg}" Margin="0,0,16,0">
                                <TextBlock Text="🐾" FontSize="18" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                            </Border>
                            <TextBlock Text="Thông tin thú cưng" Style="{StaticResource SectionTitleText}" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Expander.Header>
                    <StackPanel>
                        <TextBlock Text="Tên thú cưng" Style="{StaticResource LabelText}" Margin="0,0,0,8"/>
                        <TextBox Style="{StaticResource ModernInput}" Text="{Binding PetName, UpdateSourceTrigger=PropertyChanged}" HorizontalAlignment="Stretch"/>
                        <Button Content="Lưu tên thú cưng" Style="{StaticResource PrimaryButton}" 
                                Command="{Binding SavePetCommand}" HorizontalAlignment="Left" Margin="0,16,0,0" Width="149"/>
                    </StackPanel>
                </Expander>

                <Expander Style="{StaticResource SectionExpander}">
                    <Expander.Header>
                        <StackPanel Orientation="Horizontal">
                            <Border Width="40" Height="40" CornerRadius="12" Background="{StaticResource IconBg}" Margin="0,0,16,0">
                                <TextBlock Text="⏰" FontSize="18" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                            </Border>
                            <TextBlock Text="Thiết lập mốc thời gian" Style="{StaticResource SectionTitleText}" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Expander.Header>
                    <StackPanel>
                        <UniformGrid Columns="3">
                            <StackPanel Margin="0,0,12,0">
                                <TextBlock Text="Buổi sáng" Style="{StaticResource LabelText}"/>
                                <TextBox Style="{StaticResource ModernInput}" Text="{Binding MorningTime}"/>
                            </StackPanel>
                            <StackPanel Margin="6,0,6,0">
                                <TextBlock Text="Buổi chiều" Style="{StaticResource LabelText}"/>
                                <TextBox Style="{StaticResource ModernInput}" Text="{Binding AfternoonTime}"/>
                            </StackPanel>
                            <StackPanel Margin="12,0,0,0">
                                <TextBlock Text="Buổi tối" Style="{StaticResource LabelText}"/>
                                <TextBox Style="{StaticResource ModernInput}" Text="{Binding EveningTime}"/>
                            </StackPanel>
                        </UniformGrid>
                        <Button Content="Lưu thời gian" Style="{StaticResource PrimaryButton}" 
                                Command="{Binding SaveTimesCommand}" HorizontalAlignment="Left" Margin="0,16,0,0" Width="124"/>
                    </StackPanel>
                </Expander>

                <Border Style="{StaticResource CardStyle}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <Border Width="40" Height="40" CornerRadius="12" Background="{StaticResource IconBg}" Margin="0,0,16,0">
                            <TextBlock Text="✈️" FontSize="16" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                        </Border>
                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                            <TextBlock Text="Chế độ kỳ nghỉ" Style="{StaticResource SectionTitleText}"/>
                            <TextBlock Text="Tạm dừng chuỗi thói quen." Style="{StaticResource HintText}"/>
                        </StackPanel>
                        <ToggleButton Grid.Column="2" IsChecked="{Binding VacationMode}" Style="{StaticResource SwitchStyle}" VerticalAlignment="Center"/>
                    </Grid>
                </Border>

                <Expander Style="{StaticResource SectionExpander}">
                    <Expander.Header>
                        <StackPanel Orientation="Horizontal">
                            <Border Width="40" Height="40" CornerRadius="12" Background="{StaticResource IconBg}" Margin="0,0,16,0">
                                <TextBlock Text="💬" FontSize="16" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                            </Border>
                            <TextBlock Text="Phản hồi &amp; Đánh giá" Style="{StaticResource SectionTitleText}" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Expander.Header>

                    <StackPanel>
                        <StackPanel HorizontalAlignment="Center" Margin="0,0,0,24">
                            <TextBlock Text="Bạn cảm thấy thế nào về ứng dụng?" FontSize="15" FontWeight="SemiBold" 
                                       Foreground="{StaticResource TextMain}" HorizontalAlignment="Center" Margin="0,0,0,12"/>

                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <RadioButton GroupName="Rating" Tag="1" Click="Rating_Click" Style="{StaticResource StarRadio}"/>
                                <RadioButton GroupName="Rating" Tag="2" Click="Rating_Click" Style="{StaticResource StarRadio}"/>
                                <RadioButton GroupName="Rating" Tag="3" Click="Rating_Click" Style="{StaticResource StarRadio}"/>
                                <RadioButton GroupName="Rating" Tag="4" Click="Rating_Click" Style="{StaticResource StarRadio}"/>
                                <RadioButton GroupName="Rating" Tag="5" Click="Rating_Click" Style="{StaticResource StarRadio}"/>
                            </StackPanel>

                            <TextBlock Text="Chọn mức độ hài lòng của bạn" Foreground="{StaticResource TextSecondary}" 
                                       FontSize="12" HorizontalAlignment="Center" Margin="0,8,0,0"/>
                        </StackPanel>

                        <Border BorderBrush="{StaticResource Border}" BorderThickness="0,1,0,0" Margin="0,0,0,24"/>

                        <StackPanel>
                            <TextBlock Text="Chi tiết báo cáo lỗi hoặc góp ý:" Style="{StaticResource LabelText}" Margin="0,0,0,8"/>
                            <TextBox Style="{StaticResource ModernInput}" Height="100" TextWrapping="Wrap" AcceptsReturn="True" 
                                     VerticalContentAlignment="Top" Text="{Binding FeedbackContent, UpdateSourceTrigger=PropertyChanged}"/>

                            <Button Content="Gửi phản hồi" Style="{StaticResource PrimaryButton}" 
                                    Command="{Binding SendFeedbackCommand}" HorizontalAlignment="Right" Margin="0,16,0,0" Width="150"/>
                        </StackPanel>
                    </StackPanel>
                </Expander>

            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl>
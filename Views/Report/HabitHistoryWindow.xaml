<Window x:Class="OOP_Semester.Views.Report.HabitHistoryWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Lịch sử thói quen" Height="550" Width="420"
        WindowStartupLocation="CenterOwner" AllowsTransparency="True" 
        WindowStyle="None" Background="Transparent">
    <Window.Resources>
        <DropShadowEffect x:Key="CardShadow" BlurRadius="15" ShadowDepth="1" Opacity="0.05" Color="Black"/>
    </Window.Resources>
    <Border Background="White" CornerRadius="25" Effect="{StaticResource CardShadow}">
        <StackPanel Margin="25">
            <Grid Margin="0,0,0,20">
                <StackPanel>
                    <TextBlock Text="{Binding Habit.Name}" FontSize="20" FontWeight="Bold" Foreground="#1F2937"/>
                    <TextBlock Text="{Binding MonthYearTitle}" FontSize="12" Foreground="Gray"/>
                </StackPanel>
                <Button Content="✕" HorizontalAlignment="Right" VerticalAlignment="Top" 
                        Click="Close_Click" Cursor="Hand" Background="Transparent" BorderThickness="0" Foreground="#9CA3AF"/>
            </Grid>

            <UniformGrid Columns="2" Margin="0,0,0,25">
                <Border Background="#FFF7ED" CornerRadius="15" Padding="15" Margin="0,0,8,0">
                    <StackPanel>
                        <TextBlock Text="🔥 Hiện tại" FontSize="11" Foreground="#C2410C"/>
                        <TextBlock Text="{Binding CurrentStreak, StringFormat='{}{0} ngày'}" FontSize="22" FontWeight="Bold" Foreground="#EA580C"/>
                    </StackPanel>
                </Border>
                <Border Background="#F0F9FF" CornerRadius="15" Padding="15" Margin="8,0,0,0">
                    <StackPanel>
                        <TextBlock Text="🏆 Kỷ lục" FontSize="11" Foreground="#0369A1"/>
                        <TextBlock Text="{Binding BestStreak, StringFormat='{}{0} ngày'}" FontSize="22" FontWeight="Bold" Foreground="#0284C7"/>
                    </StackPanel>
                </Border>
            </UniformGrid>

            <UniformGrid Columns="7" Margin="0,0,0,10">
                <UniformGrid.Resources>
                    <Style TargetType="TextBlock">
                        <Setter Property="HorizontalAlignment" Value="Center"/>
                        <Setter Property="FontSize" Value="11"/>
                        <Setter Property="FontWeight" Value="Bold"/>
                        <Setter Property="Foreground" Value="#9CA3AF"/>
                    </Style>
                </UniformGrid.Resources>
                <TextBlock Text="T2"/>
                <TextBlock Text="T3"/>
                <TextBlock Text="T4"/>
                <TextBlock Text="T5"/>
                <TextBlock Text="T6"/>
                <TextBlock Text="T7"/>
                <TextBlock Text="CN"/>
            </UniformGrid>

            <ItemsControl ItemsSource="{Binding DaysInMonth}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <UniformGrid Columns="7"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border x:Name="DayBorder" Width="42" Height="42" Margin="2" CornerRadius="21">
                            <Grid>
                                <TextBlock x:Name="DayText" Text="{Binding Date.Day}" VerticalAlignment="Center" HorizontalAlignment="Center" FontSize="13" Foreground="#374151"/>
                                <Ellipse x:Name="CheckDot" Fill="#10B981" Width="4" Height="4" VerticalAlignment="Bottom" Margin="0,0,0,6" Visibility="Collapsed"/>
                            </Grid>
                        </Border>
                        <DataTemplate.Triggers>
                            <DataTrigger Binding="{Binding IsCurrentMonth}" Value="False">
                                <Setter TargetName="DayText" Property="Foreground" Value="#D1D5DB"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding IsCompleted}" Value="True">
                                <Setter TargetName="DayBorder" Property="Background" Value="#DCFCE7"/>
                                <Setter TargetName="DayText" Property="Foreground" Value="#059669"/>
                                <Setter TargetName="DayText" Property="FontWeight" Value="Bold"/>
                                <Setter TargetName="CheckDot" Property="Visibility" Value="Visible"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding IsToday}" Value="True">
                                <Setter TargetName="DayBorder" Property="BorderBrush" Value="#EE7C2B"/>
                                <Setter TargetName="DayBorder" Property="BorderThickness" Value="1.5"/>
                            </DataTrigger>
                        </DataTemplate.Triggers>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>

            <TextBlock Text="* Những ngày màu xanh là ngày bạn hoàn thành thói quen" Foreground="#9CA3AF" FontSize="10" Margin="0,20,0,0" HorizontalAlignment="Center" FontStyle="Italic"/>
        </StackPanel>
    </Border>
</Window>